var thegrid=function(t){var i,e,o,n,s,r=this,l={grid:$(".thegrid"),cells:$(".cell"),cellsPerRow:7,cellHeight:100,useJsTransitions:!1,animationSpeed:500,animationEasing:"linear",animationDelay:0,updateGridHeight:!0,throttling:!1,throttlingDelay:300,breakpoints:{}},a={matrix:[],cols:0,rows:0,emptyCells:[],init:function(){this.emptyCells=[],this.cols=r.options.cellsPerRow,this.rows=Math.ceil(o/this.cols),this.matrix=matrix(this.cols,this.rows,null);for(var t=0;t<this.rows;t++)for(var i=0;i<r.options.cellsPerRow;i++)this.emptyCells.push(t+"."+i);return this},addEmptyCell:function(t){this.emptyCells.push(t[1]+"."+t[0]),this.emptyCells.sort(function(t,i){return t-i})},removeEmptyCell:function(t){var i=this.emptyCells.indexOf(t[1]+"."+t[0]);i>-1&&this.emptyCells.splice(i,1),this.emptyCells.sort(function(t,i){return t-i})},inject:function(t,i,e){var o={w:i[0],h:i[1]},n=o.w,s=o.h;for(void 0===e&&(e=this.getNextEmptyCell());!this.canFit(i,e);)e=this.getNextCell(e);for(var r=e[0],l=e[1];n>0;){for(this.matrix[l][r]=t,this.removeEmptyCell([r,l]),s=o.h-1;s>0;)l++,this.matrix[l][r]=t,this.removeEmptyCell([r,l]),s--;n--,r++}return e},getNextEmptyCell:function(){if(!this.emptyCells.length)return this.addNewRow();var t=this.emptyCells[0].split(".");return[parseInt(t[1]),parseInt(t[0])]},getNextCell:function(t){return void 0===t&&(t=[0,0]),void 0!==this.matrix[t[1]][t[0]+1]?[t[0]+1,t[1]]:[0,t[1]+1]},addNewRow:function(){this.matrix.push(matrix(this.cols,1,null)[0]),this.rows++;for(var t=0;t<this.cols;t++)this.addEmptyCell([t,this.rows-1]);return[0,this.rows-1]},isCellEmpty:function(t){return void 0===this.matrix[t[1]]?(this.addNewRow(),!0):null===this.matrix[t[1]][t[0]]},canFit:function(t,i){for(var e=t[0],o=t[1],n=i[0],s=i[1],r=0,l=0,a=n;n+e>a;a++)this.isCellEmpty([a,s])===!0&&r++;for(var h=s;s+o>h;h++)this.isCellEmpty([n,h])===!0&&l++;return r>=e&&l>=o}};r.throttleTimer=null,r.fillMatrix=function(){a.init(r.options.cellsPerRow,Math.ceil(o/r.options.cellsPerRow),null),e.each(function(t,i){i=$(i);var e=Math.min(i.data("width"),r.options.cellsPerRow)||1,o=i.data("height")||1,n=a.inject(t,[Math.min(e,r.options.cellsPerRow),o]);i[0].matrixPosition={x:n[0],y:n[1]}})},r.render=function(){e.each(function(t,i){i=$(i);var e=Math.min(i.data("width"),r.options.cellsPerRow)||1,o=i.data("height")||1,l={width:n*e+"%",height:s*o,top:i[0].matrixPosition.y*s,left:100*i[0].matrixPosition.x/r.options.cellsPerRow+"%"};setTimeout(function(){r.options.useJsTransitions?i.stop(!0,!0).animate(l,r.options.animationSpeed,r.options.animationEasing):i.css(l)},r.options.animationDelay)}),r.options.updateGridHeight&&i.height(a.rows*r.options.cellHeight)},r.updateParams=function(i){return r.options=$.extend(t,i),n=100/r.options.cellsPerRow,s=r.options.cellHeight,this},r.filter=function(t,i,n){return i=void 0!==i?i:!1,n=void 0!==n?n:!1,t=t instanceof jQuery?t:$(t),cellsToShow=i?n?$(r.options.cells).not(t):null:t,cellsToHide=i?t:n?$(r.options.cells).not(t):null,cellsToShow&&cellsToShow.css({top:0,left:0}).removeClass("hidden"),cellsToHide&&(cellsToHide.addClass("hidden"),setTimeout(function(){cellsToHide.css({top:0,left:0})},r.options.animationSpeed)),e=cellsToShow,o=e.length,this},r.resetFilter=function(){return e=$(r.options.cells).removeClass("hidden"),o=e.length,this},r.redraw=function(){return r.fillMatrix(),r.render(),this},r.bindEvents=function(){if(!$.isEmptyObject(r.options.breakpoints)){var t,e,o=[],n=0;for(var s in r.options.breakpoints)o.push(1*s);e=o.length,o.sort(function(t,i){return 1*t-1*i}),n=o[e-1]+"++",r.options.breakpoints[n]=JSON.parse(JSON.stringify(r.options)),delete r.options.breakpoints[n].breakpoints,o.push(n),e++,$(window).on("resize gridInit afterResize",function(e){if(r.options.throttling&&"resize"===e.type)return r.throttleTimer=setTimeout(function(){clearTimeout(r.throttleTimer),r.throttleTimer=null,$(window).trigger("afterResize")},r.options.throttlingDelay),!0;var n,s={},l=this.innerWidth,a=[],h=!1;a=o.slice(0),a.push(l),a.sort(function(t,i){return"string"==typeof t&&t.indexOf("++")>-1||1*t-1*i});var p=a.indexOf(l);n=o[p],h=n!==t,(h||"function"==typeof r.options.cellHeight)&&(t=n,"gridInit"!==e.type&&h&&i.trigger("breakpointChange",[t]),s=r.options.breakpoints[t],r.updateParams(s).redraw())})}};(function(){r.options=$.extend(l,t),i=$(r.options.grid),e=$(r.options.cells).not(".hidden"),o=e.length,n=100/r.options.cellsPerRow,s=r.options.cellHeight,i.css("height",Math.ceil(o/r.options.cellsPerRow)*r.options.cellHeight),r.bindEvents(),r.fillMatrix(),r.render(),$.isEmptyObject(r.options.breakpoints)||$(window).trigger("gridInit"),i.trigger("ready").addClass("ready"+(r.options.useJsTransitions?"":" transitions"))})()},matrix=function(t,i,e){for(var o=0,n=[];i>o;o++){n.push([]),n[o].push(new Array(t));for(var s=0;t>s;s++)n[o][s]=e}return n};$.fn.grid=function(t){var i=this[0];if(!i||void 0===i)return void console.error("Can't instanciate The Grid on an empty jQuery collection.");if(-1===["object","undefined","string"].indexOf(typeof t))return void console.warn("Ignoring grid call with wrong params.");if("object"==typeof t||void 0===t)(t||{grid:null}).grid=i,i.grid=new thegrid(t);else if("string"==typeof t&&void 0!==i&&"function"==typeof i.grid[t]){var e=[].slice.call(arguments,1);i.grid[t].apply(this,e)}return this};