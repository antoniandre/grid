var gridHandler=function(a){var b=this,m,e,g,k,p,r={grid:$(".thegrid"),cells:$(".cell"),cellsPerRow:7,cellHeight:100,useCssTransitions:!0,animationSpeed:500,animationEasing:"linear",updateGridHeight:!0,throttling:!1,throttlingDelay:300,breakpoints:{}},q={matrix:[],cols:0,rows:0,emptyCells:[],init:function(){this.emptyCells=[];this.cols=a.cellsPerRow;this.rows=Math.ceil(g/this.cols);this.matrix=matrix(this.cols,this.rows,null);for(var d=0;d<this.rows;d++)for(var c=0;c<a.cellsPerRow;c++)this.emptyCells.push(d+"."+c);return this},addEmptyCell:function(d){this.emptyCells.push(d[1]+"."+d[0]);this.emptyCells.sort(function(d,a){return d-a})},removeEmptyCell:function(d){d=this.emptyCells.indexOf(d[1]+"."+d[0]);-1<d&&this.emptyCells.splice(d,1);this.emptyCells.sort(function(d,a){return d-a})},inject:function(d,a,l){var c=a[1],b=a[0];for(void 0===l&&(l=this.getNextEmptyCell());!this.canFit(a,l);)l=this.getNextCell(l);for(var f=l[0],h=l[1];0<b;){this.matrix[h][f]=d;this.removeEmptyCell([f,h]);for(a=c-1;0<a;)h++,this.matrix[h][f]=d,this.removeEmptyCell([f,h]),a--;b--;f++}return l},getNextEmptyCell:function(){if(!this.emptyCells.length)return this.addNewRow();var a=this.emptyCells[0].split(".");return[parseInt(a[1]),parseInt(a[0])]},getNextCell:function(a){void 0===a&&(a=[0,0]);return void 0!==this.matrix[a[1]][a[0]+1]?[a[0]+1,a[1]]:[0,a[1]+1]},addNewRow:function(){this.matrix.push(matrix(this.cols,1,null)[0]);this.rows++;for(var a=0;a<this.cols;a++)this.addEmptyCell([a,this.rows-1]);return[0,this.rows-1]},isCellEmpty:function(a){return void 0===this.matrix[a[1]]?(this.addNewRow(),!0):null===this.matrix[a[1]][a[0]]},canFit:function(a,c){for(var d=a[0],b=a[1],e=c[0],f=c[1],h=0,g=0,n=e;n<e+d;n++)!0===this.isCellEmpty([n,f])&&h++;for(n=f;n<f+b;n++)!0===this.isCellEmpty([e,n])&&g++;return h>=d&&g>=b}};b.options=a;b.throttleTimer=null;b.options=a;b.fillMatrix=function(){q.init(a.cellsPerRow,Math.ceil(g/a.cellsPerRow),null);e.each(function(d,c){c=$(c);var b=Math.min(c.data("width"),a.cellsPerRow)||1,e=c.data("height")||1,b=q.inject(d,[Math.min(b,a.cellsPerRow),e]);c[0].matrixPosition={x:b[0],y:b[1]}})};b.render=function(){e.each(function(b,c){c=$(c);var d=Math.min(c.data("width"),a.cellsPerRow)||1,e=c.data("height")||1;c.stop(!0,!0).animate({width:k*d+"%",height:p*e,top:c[0].matrixPosition.y*p,left:100*c[0].matrixPosition.x/a.cellsPerRow+"%"},a.animationSpeed,a.animationEasing)});a.updateGridHeight&&m.height(q.rows*a.cellHeight)};b.updateParams=function(b){a=$.extend(a,b);k=100/a.cellsPerRow;p=a.cellHeight};b.redraw=function(){b.fillMatrix();b.render()};b.bindEvents=function(){if(!$.isEmptyObject(a.breakpoints)){var d=a,c,e=[],g,k;for(k in a.breakpoints)e.push(1*k);g=e.length;e.sort(function(a,b){return a-b});$(window).on("resize gridInit afterResize",function(f){if(a.throttling&&"resize"===f.type)return b.throttleTimer=setTimeout(function(){clearTimeout(b.throttleTimer);b.throttleTimer=null;$(window).trigger("afterResize")},a.throttlingDelay),!0;f={};f=this.innerWidth;var h=[],h=e.slice(0);h.push(f);h.sort(function(a,b){return a-b});h=h.indexOf(f);f=h===g?"largest":e[h];if((breakpointChange=f!==c)||"function"===typeof a.cellHeight)c=f,breakpointChange&&m.trigger("breakpointChange",[c]),f=h===g?d:a.breakpoints[c],b.updateParams(f),b.redraw()})}};b.filter=function(b,c,k){if(k)$(b)[c?"hide":"show"]().siblings(a.cells)[c?"show":"hide"]();else $(b)[c?"hide":"show"]();a.cells=".cell:visible";e=$(a.cells);g=e.length};a=$.extend(r,a);m=$(a.grid);e=$(a.cells);g=e.length;k=100/a.cellsPerRow;p=a.cellHeight;m.css("height",Math.ceil(g/a.cellsPerRow)*a.cellHeight);b.bindEvents();b.fillMatrix();b.render();$.isEmptyObject(a.breakpoints)||$(window).trigger("gridInit");m.trigger("init").addClass("thegrid ready"+(a.useCssTransitions?" transitions":""));b.init=void 0},matrix=function(a,b,m){for(var e=0,g=[];e<b;e++){g.push([]);g[e].push(Array(a));for(var k=0;k<a;k++)g[e][k]=m}return g};$.fn.grid=function(a){a.grid=this.selector;new gridHandler(a);return this};